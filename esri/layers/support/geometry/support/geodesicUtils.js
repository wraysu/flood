// COPYRIGHT © 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","@dojo/framework/shim/object","../.","../../core/Error","../../core/unitUtils"],(function(e,a,t,n,r,i){Object.defineProperty(a,"__esModule",{value:!0});var s=Math.PI/180,f=n.SpatialReference.WGS84,o=/SPHEROID\[([^\]]+)]/i,c={4326:{a:6378137,f:1/298.257223563},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:1737400,f:0},104904:{a:3393400,f:.005207166853303471},104905:{a:3396190,f:.005886007555525457},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:.09796243445941462},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:.022927344575296365},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:3396190,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};function h(e){if(!e||!e.isGeographic)return null;if(e.wkid){var a=c[e.wkid];if(a)return a}if(e.wkt){var t=o.exec(e.wkt);if(!t||2!==t.length)return null;var n=t[1].split(",");if(!n||3!==n.length)return null;var r=parseFloat(n[1]),i=parseFloat(n[2]);return isNaN(r)||isNaN(i)?null:{a:r,f:0===i?0:1/i}}return null}function l(e){var a=h(e||f);if(function(e){return"b"in e&&"eSq"in e&&"radius"in e}(a))return a;var n=a.a*(1-a.f);return t.assign(a,{b:n,eSq:1-Math.pow(n/a.a,2),radius:(2*a.a+n)/3})}function p(e,a,t){var n,r=l(t),i=r.a,f=r.eSq,o=Math.sqrt(f),c=Math.sin(a[1]*s),h=i*a[0]*s;f>0?n=i*((1-f)*(c/(1-f*(c*c))-1/(2*o)*Math.log((1-o*c)/(1+o*c))))*.5:n=i*c;return e[0]=h,e[1]=n,e}function u(e){return null!==h(e)}function d(e,a){if("polyline"!==e.type&&"polygon"!==e.type)throw new r("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");var t=e.spatialReference;if(!u(t))throw new r("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");var i=l(t).radius/1e4;a<i&&(a=i);for(var s=[],f=[0,0],o={distance:null},c=0,h="polyline"===e.type?e.paths:e.rings;c<h.length;c++){var p=h[c],d=[];s.push(d),d.push([p[0][0],p[0][1]]);for(var M=p[0][0],m=p[0][1],w=void 0,y=void 0,R=0;R<p.length-1;R++)if(w=p[R+1][0],y=p[R+1][1],M!==w||m!==y){var b=[M,m];g(o,[M,m],[w,y],t);var q=o.azimuth,S=o.distance,z=S/a;if(z>1){for(var P=1;P<=z-1;P++){v(f,b,q,P*a,t),d.push(f.slice(0))}v(f,b,q,(S+Math.floor(z-1)*a)/2,t),d.push(f.slice(0))}v(f,b,q,S,t),d.push(f.slice(0)),M=f[0],m=f[1]}}return"polyline"===e.type?new n.Polyline({paths:s,spatialReference:t}):new n.Polygon({rings:s,spatialReference:t})}function v(e,a,t,n,r){for(var i,f,o,c=a[0],h=a[1],p=c*s,u=h*s,d=t*s,v=l(r),g=v.a,M=v.b,m=v.f,w=Math.sin(d),y=Math.cos(d),R=(1-m)*Math.tan(u),b=1/Math.sqrt(1+R*R),q=R*b,S=Math.atan2(R,y),z=b*w,P=z*z,x=1-P,N=x*(g*g-M*M)/(M*M),k=1+N/16384*(4096+N*(N*(320-175*N)-768)),D=N/1024*(256+N*(N*(74-47*N)-128)),G=n/(M*k),U=2*Math.PI;Math.abs(G-U)>1e-12;)o=Math.cos(2*S+G),U=G,G=n/(M*k)+D*(i=Math.sin(G))*(o+D/4*((f=Math.cos(G))*(2*o*o-1)-D/6*o*(4*i*i-3)*(4*o*o-3)));var j=q*i-b*f*y,A=Math.atan2(q*f+b*i*y,(1-m)*Math.sqrt(P+j*j)),F=Math.atan2(i*w,b*f-q*i*y),I=m/16*x*(4+m*(4-3*x)),E=A/s,O=(p+(F-(1-I)*m*z*(G+I*i*(o+I*f*(2*o*o-1)))))/s;return e.splice(0,e.length),e.push(O,E),e}function g(e,a,t,n){var r,i,f,o,c,h,p,u,d,v,g=a[0]*s,M=a[1]*s,m=t[0]*s,w=t[1]*s,y=l(n),R=y.a,b=y.b,q=y.f,S=y.radius,z=m-g,P=Math.atan((1-q)*Math.tan(M)),x=Math.atan((1-q)*Math.tan(w)),N=Math.sin(P),k=Math.cos(P),D=Math.sin(x),G=Math.cos(x),U=1e3,j=z;do{if(p=Math.sin(j),u=Math.cos(j),0===(f=Math.sqrt(G*p*(G*p)+(k*D-N*G*u)*(k*D-N*G*u))))return{distance:0};c=N*D+k*G*u,h=Math.atan2(f,c),o=c-2*N*D/(i=1-(d=k*G*p/f)*d),isNaN(o)&&(o=0),r=j,j=z+(1-(v=q/16*i*(4+q*(4-3*i))))*q*d*(h+v*f*(o+v*c*(2*o*o-1)))}while(Math.abs(j-r)>1e-12&&--U>0);if(0===U){var A=S,F=Math.acos(Math.sin(M)*Math.sin(w)+Math.cos(M)*Math.cos(w)*Math.cos(m-g))*A,I=m-g,E=Math.sin(I)*Math.cos(w),O=Math.cos(M)*Math.sin(w)-Math.sin(M)*Math.cos(w)*Math.cos(I);return{azimuth:Math.atan2(E,O)/s,distance:F}}var _=i*(R*R-b*b)/(b*b),H=_/1024*(256+_*(_*(74-47*_)-128)),L=b*(1+_/16384*(4096+_*(_*(320-175*_)-768)))*(h-H*f*(o+H/4*(c*(2*o*o-1)-H/6*o*(4*f*f-3)*(4*o*o-3)))),W=Math.atan2(G*Math.sin(j),k*D-N*G*Math.cos(j)),B=Math.atan2(k*Math.sin(j),k*D*Math.cos(j)-N*G);return e.azimuth=W/s,e.distance=L,e.reverseAzimuth=B/s,e}a.isSupported=u,a.geodesicAreas=function(e,a){if(void 0===a&&(a="square-meters"),e.some((function(e){return!u(e.spatialReference)})))throw new r("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var t=[],n=0;n<e.length;n++){var s=e[n],f=.0015696101447650193*l(m=s.spatialReference).radius;t.push(d(s,f))}for(var o=[],c=[0,0],h=[0,0],v=0;v<t.length;v++){for(var g=t[v],M=g.rings,m=g.spatialReference,w=0,y=0;y<M.length;y++){var R=M[y];p(c,R[0],m),p(h,R[R.length-1],m);for(var b=h[0]*c[1]-c[0]*h[1],q=0;q<R.length-1;q++)p(c,R[q+1],m),p(h,R[q],m),b+=h[0]*c[1]-c[0]*h[1];w+=b}w=i.convertUnit(w,"square-meters",a),o.push(w/-2)}return o},a.geodesicLengths=function(e,a){void 0===a&&(a="meters");var t=e,n=e;if(!t&&!n)throw new r("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t?t.some((function(e){return!u(e.spatialReference)})):n.some((function(e){return!u(e.spatialReference)})))throw new r("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var s=[],f=0;f<e.length;f++){for(var o=e[f],c=o.spatialReference,h="polyline"===o.type?o.paths:o.rings,l=0,p=0;p<h.length;p++){for(var d=h[p],v=0,M=1;M<d.length;M++){var m=d[M-1][0],w=d[M][0],y=d[M-1][1],R=d[M][1];if(y!==R||m!==w){var b={distance:null};g(b,[m,y],[w,R],c),v+=b.distance}}l+=v}l=i.convertUnit(l,"meters",a),s.push(l)}return s},a.geodesicDensify=d,a.directGeodeticSolver=v,a.inverseGeodeticSolver=g,a.geodesicDistance=function(e,a,t){if(void 0===t&&(t="meters"),!e||!a)throw new r("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!e.spatialReference||!a.spatialReference)throw new r("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!e.spatialReference.equals(a.spatialReference))throw new r("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");var n=e.spatialReference;if(!u(n))throw new r("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(e.equals(a))return{distance:0,azimuth:0,reverseAzimuth:0};var s={distance:null};return g(s,[e.x,e.y],[a.x,a.y],n),s.distance=i.convertUnit(s.distance,"meters",t),s},a.pointFromDistance=function(e,a,t){if(!e||null==a||null==t)throw new r("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(t<0||t>360)throw new r("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0° to 360° degrees");if(!e.spatialReference)throw new r("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");var i=e.spatialReference;if(!u(i))throw new r("geodesic-distance:not-supported","input geometry spatial reference is not supported");var s=[0,0];return v(s,[e.x,e.y],t,a,i),new n.Point({x:s[0],y:s[1],spatialReference:i})}}));