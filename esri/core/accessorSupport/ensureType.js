// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../compilerUtils","../Logger"],(function(e,n,r,t){Object.defineProperty(n,"__esModule",{value:!0});var u=t.getLogger("esri.core.Accessor");function o(e){return null==e?e:new Date(e)}function a(e){return null==e?e:!!e}function i(e){return null==e?e:e.toString()}function s(e){return null==e?e:"number"==typeof e&&isNaN(e)?0:parseFloat(e)}function l(e){return null==e?e:Math.round(parseFloat(e))}function c(e){return e&&e.constructor&&void 0!==e.constructor._meta}function f(e,n){return null!=n&&e&&!(n instanceof e)}function y(e){return e&&("isCollection"in e||e._meta&&e._meta.bases&&e._meta.bases.some((function(e){return"isCollection"in e})))}function p(e){return e&&e.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function v(e,n){return!!c(n)&&(u.error("Accessor#set","Assigning an instance of '"+(n.declaredClass||"unknown")+"' which is not a subclass of '"+g(e)+"'"),!0)}function d(e,n){return null==n?n:y(e)?function(e,n){if(!n||!n.constructor||!y(n.constructor))return v(e,n)?n:new e(n);var r=p(e.prototype.itemType),t=p(n.constructor.prototype.itemType);if(!r)return n;if(!t)return new e(n);if(r===t)return n;var u=t._meta&&t._meta.bases;return u&&-1!==u.indexOf(r)?new e(n):(v(e,n),n)}(e,n):f(e,n)?v(e,n)?n:new e(n):n}function g(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}function b(e){switch(e){case Number:return s;case T:return l;case Boolean:return a;case String:return i;case Date:return o;default:return d.bind(null,e)}}function h(e,n){var r=b(e);return 1===arguments.length?r:r(n)}function m(e,n,r){return 1===arguments.length?m.bind(null,e):n?Array.isArray(n)?n.map((function(n){return e(n,r)})):[e(n,r)]:n}function A(e,n,r){return 0!==n&&Array.isArray(r)?r.map((function(r){return A(e,n-1,r)})):e(r)}function w(e,n,r){if(2===arguments.length)return w.bind(null,e,n);if(!r)return r;for(var t=n,u=r=A(e,n,r);t>0&&Array.isArray(u);)t--,u=u[0];if(void 0!==u)for(var o=0;o<t;o++)r=[r];return r}n.ensureDate=o,n.ensureBoolean=a,n.ensureString=i,n.ensureNumber=s,n.ensureInteger=l,n.isClassedType=c,n.requiresType=f,n.ensureClass=d,n.ensureType=h,n.ensureArrayTyped=m,n.ensureArray=function(e,n){return 1===arguments.length?m(h.bind(null,e)):m(h.bind(null,e),n)},n.ensureNArrayTyped=w,n.ensureNArray=function(e,n,r){return 2===arguments.length?w(h.bind(null,e),n):w(h.bind(null,e),n,r)},n.isOneOf=function(e){return!!Array.isArray(e)&&!e.some((function(n){var r=typeof n;return!("string"===r||"number"===r||"function"===r&&e.length>1)}))},n.ensureOneOf=function e(n,r){if(2===arguments.length)return e(n).call(null,r);for(var t=new Set,o=n.filter((function(e){return"function"!=typeof e})),a=n.filter((function(e){return"function"==typeof e})),i=0,s=n;i<s.length;i++){var l=s[i];"string"!=typeof l&&"number"!=typeof l||t.add(l)}var c=null,y=null;return function(e,n){if(null==e)return e;var r=typeof e,i="string"===r||"number"===r;return i&&(t.has(e)||a.some((function(e){return"string"===r&&e===String||"number"===r&&e===Number})))?e:"object"===r&&a.some((function(n){return!f(e,n)}))?e:(i&&o.length?(c||(c=o.map((function(e){return"string"==typeof e?"'"+e+"'":""+e})).join(", ")),u.error("Accessor#set","'"+e+"' is not a valid value for this property, only the following values are valid: "+c)):"object"==typeof e&&a.length?(y||(y=a.map((function(e){return g(e)})).join(", ")),u.error("Accessor#set","'"+e+"' is not a valid value for this property, value must be one of "+y)):u.error("Accessor#set","'"+e+"' is not a valid value for this property"),n&&(n.valid=!1),null)}},n.ensureOneOfType=function e(n,r){if(2===arguments.length)return e(n).call(null,r);var t={},o=[],a=[];for(var i in n.typeMap){var s=n.typeMap[i];t[i]=h(s),o.push(g(s)),a.push(i)}var l=function(){return"'"+o.join("', '")+"'"},y=function(){return"'"+a.join("', '")+"'"},p="string"==typeof n.key?function(e){return e[n.key]}:n.key;return function(e){if(n.base&&!f(n.base,e))return e;if(null==e)return e;var r=p(e)||n.defaultKeyValue,o=t[r];if(!o)return u.error("Accessor#set","Invalid property value, value needs to be one of "+l()+", or a plain object that can autocast (having .type = "+y()+")"),null;if(!f(n.typeMap[r],e))return e;if("string"==typeof n.key&&!c(e)){var a={};for(var i in e)i!==n.key&&(a[i]=e[i]);return o(a)}return o(e)}};var T=function(){};n.Integer=T,n.types={native:function(e){return{type:"native",value:e}},array:function(e){return{type:"array",value:e}},oneOf:function(e){return{type:"one-of",values:e}}},n.isLongFormType=function(e){if(!(e&&"type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0;default:r.neverReachedSilent(e)}return!1},n.ensureLongFormType=function e(n){switch(n.type){case"native":return h(n.value);case"array":return m(e(n.value));case"one-of":return function(e){var n=null;return function(t,o){return function e(n,r){if(null==n)return!0;switch(r.type){case"native":switch(r.value){case Number:case T:return"number"==typeof n;case Boolean:return"boolean"==typeof n;case String:return"string"==typeof n}return n instanceof r.value;case"array":return!!Array.isArray(n)&&!n.some((function(n){return!e(n,r.value)}));case"one-of":return r.values.some((function(r){return e(n,r)}))}}(t,e)?t:(null==n&&(n=function e(n){switch(n.type){case"native":switch(n.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case T:return"integer";case Date:return"date";default:return g(n.value)}case"array":return"array of "+e(n.value);case"one-of":var t=n.values.map((function(n){return e(n)}));return"one of "+t.slice(0,t.length-1)+" or "+t[t.length-1];default:r.neverReached(n)}return"unknown"}(e)),u.error("Accessor#set","Invalid property value, value needs to be of type "+n),o&&(o.valid=!1),null)}}(n);default:r.neverReached(n)}return null},n.default=h}));